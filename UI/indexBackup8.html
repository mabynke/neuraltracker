<!-- mousedown event is commented out in this version -->

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset = "UTF-8">
	<title> Tracking UI </title>
	<script src="jquery-3.2.1.js"></script>
	<style>
	body {
  		margin: 0px;
		}
	</style>
</head>
<body>
	<canvas id="myCanvas" height = "" width=""> </canvas>
	<!--  style="border:1px solid #000000"; -->
	<script>
	    var c = document.getElementById("myCanvas");
    	var ctx = c.getContext("2d");// used for drawing

    	var input_location = prompt("Please enter folder location","/home/nadiaw/prosjekter/neuraltracker/UI/eksempelsekvenser");

    	var clickCoords = [];
    	var json_predict_coords = [];
    	var json_labels_coords = [];

    	var pic_num = 0;
    	var folderNum = 0;

    	var json_labels = prompt("Please enter the labels (correct answer) jsonfile name","labels.json"); // TODO: turn into userinput!
    	var json_predict = prompt("Please enter the AI prediction jsonfile name", "predictions.json");

    	var foldername = getFolderName();

  		//	/home/nadiaw/prosjekter/neuraltracker/UI/eksempelsekvens/seq00001
  		
  		function getFolderName() {
  			if (folderNum <= 0) {
       			var foldername = "/seq00000";
       		}
       		else if (folderNum < 10) {
       			var foldername = "/seq0000" + folderNum;
       		}
       		else if (folderNum < 100) {
       			var foldername = "/seq000" + folderNum;
       		}
       		else if (folderNum < 1000) {
       			var foldername = "/seq00" + folderNum;
       		}
       	return foldername
  		}


		function getJsonData(jsonfile, datalist) {
            
            while(datalist.length > 0) { // emptys both arrays, which datalist = [] doesn't do. 
    			datalist.pop();
			}

            $.ajax({url: input_location + foldername + "/" + jsonfile, async: false, dataType: "json", success: function(data) {
                x1 = data[pic_num].x1;
                y1 = data[pic_num].y1;
                x2 = data[pic_num].x2;
                y2 = data[pic_num].y2;
                filename = data[pic_num].filename;

                datalist.push(x1);
                datalist.push(y1);
                datalist.push(x2);
                datalist.push(y2);
                datalist.push(filename);
            }})
        }
		

		function getCoordinates(event){ //pushes coordinates to 'clickCoords'
			canvas_x = event.pageX; // finnes annen metode i gamle backups
			canvas_y = event.pageY;
			clickCoords.push(canvas_x);
			clickCoords.push(canvas_y);
			alert(clickCoords);
			//alert("X=" + canvas_x + " Y=" + canvas_y + "coordinates:" + clickCoords);
			//alert(userInput)
		}

		function clickEvent(event) { // happens when click is detected
			getCoordinates(event);

			if (clickCoords.length == 4) { // We have a box!

				alert('registrered a lenght of 4')
				//'refreshes then draws square'
				//ctx.clearRect(0, 0, c.width, c.height);
  				ctx.drawImage(img,0,0); // img not defines
				drawSquare(clickCoords[0],clickCoords[1],clickCoords[2],clickCoords[3]);
				alert('tried to draw a square..')
				//clickCoords = [];
			}
			if (clickCoords.length == 6) { // a box has been created, and one 'mousedown' has been registrered
				var x_within = clickCoords[4] < clickCoords[2] && clickCoords[4] > clickCoords[0];

				var y_within = clickCoords[5] < clickCoords[3] && clickCoords[5] > clickCoords[1];

				if (x_within && y_within){
					alert('within box!');
					}
				else {
					alert('outside of box!');
					}
			}
		}

		function drawSquare(x_A,y_A,x_C,y_C, colour = "#0066ff"){
			ctx.beginPath();
			ctx.moveTo(x_A, y_A);
			ctx.lineTo(x_C, y_A);
			ctx.lineTo(x_C,y_C);
			ctx.lineTo(x_A,y_C);
			ctx.lineTo(x_A,y_A);	//ctx.lineWidth = 10;
			ctx.strokeStyle = colour;
			ctx.stroke();
		}

		$(document).keydown(function(e){
		if (e.keyCode==40) { // down
		    changeFolder(-1);
		}
		else if (e.keyCode == 39) { // right
			changePic(+1);
		}
		else if (e.keyCode == 38) { // up
			changeFolder(+1);
		}
		else if (e.keyCode == 37) { // left
			changePic(-1);
		}
		});


    	function changePic(i) {
			pic_num = (pic_num + i + 12) % 12;
			getJsonData(json_labels, json_labels_coords);
			getJsonData(json_predict, json_predict_coords);

			onLoad();
    	}

    	function changeFolder(i) {
    		folderNum = folderNum + i;
    		foldername = getFolderName();

    		getJsonData(json_labels,json_labels_coords);
    		getJsonData(json_predict, json_predict_coords);

			onLoad();
    	}

    	function onLoad() { // initializing process. 
    		var img = new Image();
  			img.src = input_location + foldername + "/" + json_labels_coords[4];  // "/frame00000.jpg";

  			//alert('waiting...'); // neccesary so far...

  			setTimeout(function(){

			c.height = img.height; // gives canvas a size
    		c.width = img.width;
  			
    		ctx.drawImage(img, 0, 0); // draws image onto canvas

    		drawSquare(json_labels_coords[0], json_labels_coords[1], json_labels_coords[2], json_labels_coords[3]);

    		drawSquare(json_predict_coords[0], json_predict_coords[1], json_predict_coords[2], json_predict_coords[3], "#ff3300");

    		document.getElementById("imageTitle").innerHTML = json_labels_coords[4];

    		document.getElementById("folderTitle").innerHTML = foldername;

			}, 25); // can be increased if neccesary. 
    	}

    	getJsonData(json_labels, json_labels_coords);
    	getJsonData(json_predict, json_predict_coords);

		window.onload = onLoad();

		//document.addEventListener("mousedown", clickEvent);

		//	/home/nadiaw/prosjekter/neuraltracker/UI/eksempelsekvens/seq00001

	</script>
	<br style = "line-height: 5px">
	<i id = "folderTitle" style = "font-size: 5px;"></i>
	<i id = "imageTitle" style = "font-size: 5px;"></i>
	<br style = "line-height: 5px">
	<i id = "imageTitle" style = "font-size: 5px;"> Use arrow keys to change folder and pictures</i>

	<!--
	<button type = "button" style = "font-size: 5px; height: 10px; width:10px" onclick= "changePic(-1)" > < </button>
	<button type = "button" style = "font-size: 5px; height: 10px; width:10px" onclick= "changePic(+1)" > > </button>

	<br style = "line-height: 5px">
	<i style = "font-size: 5px;"> Folder buttons: </i>
	<br style = "line-height: 5px">


	<button type = "button" style = "font-size: 5px; height: 10px; width:10px" onclick= "changeFolder(-1)" > < </button>
	<button type = "button" style = "font-size: 5px; height: 10px; width:10px" onclick= "changeFolder(+1)" > > </button>
	-->

</body>
</html>
